provider "malwaredomainlist"
name "url_reputation"
fetch_http('http://www.malwaredomainlist.com/updatescsv.php')

parse_csv(:headers => [:detectdate, :url, :ip, :rdns, :comment, :registrar_contact, :asn]) do |event_generator, record|
  event_generator.call do |event|
    event.type = :malware_host
    if record.data[:url] == '-' then
	  url = "http://"+record.data[:ip]
	else
      url = "http://"+record.data[:url]
	end
    event.add_url(url) do |url_event|
    end
  end
end
