provider "malwaredomains"
name "dyndns_domain_reputation"
fetch_http('http://mirror2.malwaredomains.com/files/dynamic_dns.txt')

filter_whitespace
filter_comments

parse_eachline(:separator => "\n") do |event_generator, record|
  fields = record.data.split(/\t/)
  next if record.nil?
  
  remote_domain = fields[0]
  # This is a badly formatted feed, below fields won't work
  # source = fields[1]
  # description = fields[2]
  
  # Some domains are conjoined with a domain#description
  if remote_domain =~ /#/
    remote_domain.gsub!(/#.*/, '')
    end
  remote_domain.strip!
  
  event_generator.call() do |event|
    event.type = :scanning
    event.add_fqdn(remote_domain)
    end
end
